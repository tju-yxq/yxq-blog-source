{{/* Generates a valid Algolia search index */}}
{{- $.Scratch.Add "index" slice -}}
{{- $section := $.Site.GetPage "section" .Section }}
{{- range .Site.AllPages -}}
  {{- if and (and (.IsDescendant $section) (and (not .Draft) (not .Params.private))) $section.IsHome -}}
    {{- if and .File (not .Params.search_exclude) -}}   {{/* ‚üµ exclude by flag */}}
      {{- $.Scratch.Add "index" (dict
        "objectID" .File.UniqueID
        "date" .Date.UTC.Unix
        "dir" .File.Dir
        "expirydate" .ExpiryDate.UTC.Unix
        "fuzzywordcount" .FuzzyWordCount
        "keywords" .Keywords
        "kind" .Kind
        "lang" .Lang
        "lastmod" .Lastmod.UTC.Unix
        "permalink" .Permalink
        "publishdate" .PublishDate
        "readingtime" .ReadingTime
        "relpermalink" .RelPermalink
        "html" .Params.Description
        "title" .Title
        "type" .Type
        "url" .RelPermalink
        "weight" .Weight
        "wordcount" .WordCount
        "section" .Section
        "tags" .Params.Tags
        "categories" .Params.Categories
        "author" .Params.authors
        "content" (truncate 1000 .Plain)
      ) -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
{{- $.Scratch.Get "index" | jsonify -}}
